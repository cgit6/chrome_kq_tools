# lazyLoadTrigger.js 的運作邏輯

這腳本的目標是在執行觸發懶加載的過程中不影響使用者的閱覽，可以好好的在背景運行
## 1. 配置設定
- 腳本開始時，定義了一些配置參數，例如觸發的間隔時間、最多觸發的次數、是否啟用調試模式、是否進行實際的滾動操作等。

## 2. 狀態管理
- 使用一個 `state` 物件來管理當前的狀態，包括是否偵測到使用者正在滾動、最近一次滾動的時間、計時器等。

## 3. 工具函數
- 定義了一些工具函數，例如用於輸出日誌的 `log` 函數和用於獲取頁面上所有懶加載元素的 `getLazyElements` 函數。

## 4. 滾動偵測
- 設置事件監聽器來偵測使用者的滾動行為。如果使用者滾動，則更新狀態並重置計時器，當使用者停止滾動一段時間後，狀態會被更新為未滾動。

## 5. 懶加載觸發邏輯
- 當觸發懶加載時，首先記錄當前的滾動位置，然後模擬一個滾動事件，這樣可以觸發某些框架的圖片加載。
- 如果存在 `LazyLoad` 實例，則調用其更新方法，並根據配置進行實際的滾動操作。

## 6. 控制器
- 提供啟動和停止懶加載的功能，並設置定時器來定期觸發懶加載。

## 7. 初始化流程
- 確保在頁面加載完成後啟動懶加載觸發。

## 總結
整個腳本的目的是在用戶滾動頁面時，自動加載圖片或其他資源，從而提高頁面的加載效率。它通過監聽滾動事件、模擬滾動和觸發懶加載來實現這一功能，並且能夠根據用戶的行為動態調整加載策略。


---

## lazyLoadTrigger.js 的工作流程

### 1. 配置設定
- 腳本開始時，定義了一些配置參數，包括：
  - `interval`: 每次觸發懶加載的間隔時間（毫秒）。
  - `stepCount`: 最多觸發的次數。
  - `debug`: 是否啟用調試模式以輸出日誌。
  - `useActualScroll`: 是否進行實際的滾動操作。
  - `scrollAmount`: 每次滾動的距離（像素）。
  - `restoreDelay`: 滾動後多久恢復原來的位置（毫秒）。
  - `detectUserScrolling`: 是否偵測使用者的手動滾動。
  - `userScrollPauseTime`: 使用者滾動後需等待的冷卻時間（毫秒）。

### 2. 狀態管理
- 使用一個 `state` 物件來管理當前的狀態，包括：
  - `isUserScrolling`: 是否偵測到使用者正在滾動。
  - `lastUserScrollTime`: 最近一次使用者滾動的時間戳。
  - `scrollTimer`: 偵測使用者停止滾動的計時器。
  - `isScriptScrolling`: 是否目前是腳本觸發的滾動。
  - `triggerInterval`: 主要的觸發控制器。

### 3. 工具函數
- 定義了一些工具函數，例如：
  - `log`: 用於輸出日誌的函數（僅在調試模式下）。
  - `getLazyElements`: 獲取頁面上所有懶加載相關的圖片元素。

### 4. 使用者滾動偵測
- 設置事件監聽器來偵測使用者的滾動行為：
  - 當使用者滾動時，更新狀態並重置計時器。
  - 如果使用者在 150 毫秒內沒有滾動，則認為使用者已停止滾動。

### 5. 懶加載觸發邏輯
- 當觸發懶加載時，執行以下步驟：
  1. 模擬一個滾動事件，以觸發某些框架的圖片加載。
  2. 如果存在 `LazyLoad` 實例，則調用其更新方法。
  3. 手動派發自定義事件，這些事件可能被某些頁面依賴。
  4. 根據配置決定是否進行實際的滾動操作。

### 6. 控制器
- 提供啟動和停止懶加載的功能：
  - `start`: 啟動懶加載觸發，設置定時器定期觸發懶加載。
  - `stop`: 停止懶加載觸發，清除定時器。

### 7. 初始化流程
- 確保在頁面加載完成後啟動懶加載觸發：
  - 如果頁面已加載完成，則立即開始。
  - 如果頁面尚未加載完成，則設置事件監聽器，待頁面加載完成後再開始。

### 總結
整個腳本的目的是在用戶滾動頁面時，自動加載圖片或其他資源，從而提高頁面的加載效率。它通過監聽滾動事件、模擬滾動和觸發懶加載來實現這一功能，並且能夠根據用戶的行為動態調整加載策略。

---

